{
  "workflow": {
    "name": "Granular MP4 Video Detection",
    "description": "MP4 video object detection using atomic, composable nodes with DirectML GPU acceleration",
    "settings": {
      "max_parallel_nodes": 4
    }
  },
  "nodes": [
    {
      "id": "download_model",
      "function": "src.nodes.download_model.download_model_node",
      "inputs": {
        "model_name": "yolov8s.onnx",
        "models_dir": "models"
      },
      "dependencies": []
    },
    {
      "id": "detect_gpu",
      "function": "src.nodes.detect_gpus.detect_gpus_node",
      "inputs": {},
      "dependencies": []
    },
    {
      "id": "video_capture",
      "function": "src.nodes.video_ops.open_video_capture_node",
      "inputs": {
        "source": "videos/istockphoto-1585137173-640_adpp_is.mp4"
      },
      "dependencies": []
    },
    {
      "id": "directml_session",
      "function": "src.nodes.onnx_ops.create_onnx_directml_session_node",
      "inputs": {
        "model_path": "models/yolov8s.onnx",
        "device_id": 1
      },
      "dependencies": ["download_model", "detect_gpu"]
    },
    {
      "id": "video_loop",
      "function": "src.nodes.granular_video_loop.granular_video_loop_node",
      "inputs": {
        "source": "$video_capture.source",
        "width": "$video_capture.width",
        "height": "$video_capture.height",
        "fps": "$video_capture.fps",
        "session": "$directml_session.session",
        "input_name": "$directml_session.input_name",
        "model_path": "$download_model.model_path",
        "conf_threshold": 0.25,
        "iou_threshold": 0.45,
        "display_fps": true,
        "save_video": false,
        "output_path": "granular_output_detections.mp4",
        "max_duration": 0
      },
      "dependencies": ["video_capture", "directml_session", "download_model"]
    }
  ]
}

